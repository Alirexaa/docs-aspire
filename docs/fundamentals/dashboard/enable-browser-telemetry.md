---
title: Enable browser telemetry
description: Learn how to enable browser telemetry in the .NET Aspire dashboard.
ms.date: 10/03/2024
---

# Enable browser telemetry

The .NET Aspire dashboard allows consumers to configure browser telemetry, which enables scenarios where telemetry data is sent directly to the dashboard from a browser. This feature is useful for monitoring client-side performance and user interactions. Browser telemetry is enabled by configuring the OpenTelemetry Protocol (OTLP) endpoint, headers, resource attributes, and browser metadata. This article explains how to enable browser telemetry in the .NET Aspire dashboard.

In addition to [enabling CORS](configuration.md#otlp-cors), you also need the [JavaScript OTEL SDK](https://opentelemetry.io/docs/languages/js/getting-started/browser/) in your browser app.

## OTLP configuration

To enable browser telemetry, you need to configure the OTLP endpoint. The dashboard supports both gRPC and HTTP endpoints. To configure the gPRC or HTTP endpoints, specify the following environment variables:

- `DOTNET_DASHBOARD_OTLP_ENDPOINT_URL`: The gRPC endpoint to which the dashboard connects for its data.
- `DOTNET_DASHBOARD_OTLP_HTTP_ENDPOINT_URL`: The HTTP endpoint to which the dashboard connects for its data.

While the dashboard supports both gRPC and HTTP endpoints simultaneously, resources are limited to one endpoint when set from environment variables. When both endpoints are set, the gRPC endpoint is used by default. If no endpoint is set, gRPC is used with the default value of `http://localhost:18889`.

The <xref:Aspire.Hosting.OtlpConfigurationExtensions.WithOtlpExporter``1(Aspire.Hosting.ApplicationModel.IResourceBuilder{``0})> method is used to configure the OTLP exporter in the app host when adding various resources to the app model. This is called when adding project resources, Azure Functions resources, Node.js resources, and Python resources.

When the app host is in run mode, the OTLP exporter is configured:

- `OTEL_EXPORTER_OTLP_ENDPOINT` is assigned from the URL that was determined by the app host.
- `OTEL_EXPORTER_OTLP_PROTOCOL` is assigned as `grpc` or `http/protobuf` based on the URL.

### App host launch settings

The OTLP endpoint environment variables can be specified in the _launchSettings.json_ file. Consider the following example JSON file:

:::code language="json" source="snippets/BrowserTelemetry/BrowserTelemetry.AppHost/Properties/launchSettings.json" highlight="12,25,40":::

The preceding launch settings JSON file configures all profiles to include the `DOTNET_DASHBOARD_OTLP_HTTP_ENDPOINT_URL` environment variable.

## OTLP API key header

The OTLP API key `x-otlp-api-key` header is generated by the app host and is passed to apps as a standard OTEL attribute. The app host's configuration value for the `AppHost:OtlpApiKey` setting is used to generate the header value. All exporter headers are configured in the `OTEL_EXPORTER_OTLP_HEADERS` environment variable. Values are comma-delimited and formatted as `key=value`.

The header is added to all telemetry data sent to the dashboard. This header needs to be specified within the browser app so that it can be sent to the dashboard.

## Resource attributes

Resource attributes identify the resource sending telemetry data. The app host manages the `OTEL_RESOURCE_ATTRIBUTES` environment variable, which is a comma-delimited string formatted as `key=value`. For example, `"service.instance.id=71d4a6j4g4"` specifies that a service instance with the given ID can report telemetry to the dashboard.

For more information, see [.NET Aspire dashboard configuration: Resources](configuration.md#resources).

## Browser metadata

The browser app must set the appropriate `meta` element in the HTML to specify the `name="traceparent"` that corresponds to the current trace. The `traceparent` is used to correlate telemetry data to the current trace. In a .NET app for example, this would likely be assigned from the <xref:System.Diagnostics.Activity.Current?displayProperty=nameWithType> and passing its <xref:System.Diagnostics.Activity.Id?displayProperty=nameWithType> value as the `content`. For example, consider the following Razor code:

```razor
<head>
    @if (Activity.Current is { } currentActivity)
    {
        <meta name="traceparent" content="@currentActivity.Id" />
    }
    <!-- Other elements omitted for brevity... -->
</head>
```

The preceding code sets the `traceparent` meta element to the current activity ID.

## Example browser telemetry code

The following JavaScript code demonstrates the initialization of the OpenTelemetry JavaScript SDK and the sending of telemetry data to the dashboard:

:::code language="javascript" source="snippets/BrowserTelemetry/BrowserTelemetry.Web/Scripts/index.js":::

The preceding JavaScript code defines an `initializeTelemetry` function that expects the OTLP endpoint URL, the headers, and the resource attributes. These parameters are provided by the consuming browser app that pulls them from the environment variables set by the app host. Consider the following Razor code:

:::code language="razor" source="snippets/BrowserTelemetry/BrowserTelemetry.Web/Pages/Shared/_Layout.cshtml" highlight="31-38":::

> [!TIP]
> The bundling and minification of the JavaScript code is beyond the scope of this article.

For the complete working example of how to configure the JavaScript OTEL SDK to send telemetry to the dashboard, see the [browser telemetry sample](https://github.com/dotnet/aspire/tree/main/playground/BrowserTelemetry).

## See also

- [.NET Aspire dashboard configuration](configuration.md)
- [Standalone .NET Aspire dashboard](standalone.md)
- [Browser telemetry sample](https://github.com/dotnet/aspire/tree/main/playground/BrowserTelemetry)
